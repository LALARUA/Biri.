<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" class="no-js" lang="zxx">

<head>
    <meta charset="utf-8" >
	<link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" >

    <title>Airi - 编辑图书</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport' >
    <meta name="viewport" content="width=device-width" >

	<!-- Bootstrap core CSS     -->
	<link href="/adminAssets/css/bootstrap.min.css" rel="stylesheet" >

	<!--&lt;!&ndash;  Material Dashboard CSS    &ndash;&gt;-->
	<link href="/adminAssets/css/amaze.css" rel="stylesheet" >

	<!--  CSS for Demo Purpose, don't include it in your project     -->
	<link href="/adminAssets/css/demo.css" rel="stylesheet" >

	<!--     Fonts and icons     -->
	<link href="/adminAssets/css/font-awesome.min.css" rel="stylesheet">
	<link href="/adminAssets/css/font-muli.css" rel='stylesheet' type='text/css'>
	<link href="/adminAssets/css/themify-icons.css" rel="stylesheet">

	<link href="/adminAssets/vendors/sweetalert/css/sweetalert2.min.css" rel="Stylesheet" >




	<!-- Font Awesome CSS -->


	<!-- dl Icon CSS -->

	<!-- All Plugins CSS -->
	<link rel="stylesheet" href="/assets/css/plugins.css">

	<!-- Revoulation Slider CSS  -->
	<!--<link rel="stylesheet" href="/assets/css/revoulation.css">-->

	<!-- style CSS -->
	<!--<link rel="stylesheet" href="/assets/css/main.css">-->




    <!--<script src="http://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>-->
    <!--<script src="http://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>-->
	<style type="text/css">
		.myTinyBtn {
			border: 1px solid #282828;
			display: inline-block;
			font-size: 1.2rem;
			padding: .6rem 1.8rem;
			text-transform: uppercase;
			right: 0;
			top: 0; }
		.myTinyBtn:hover {
			color: #fff; }
		.filter{
			width: 80px;
			height:100px;
			overflow-x:hidden;
			overflow-y:auto;
		}
		.filter{
			scrollbar-face-color: gainsboro;/*移动滑块颜色*/
			scrollbar-shadow-color: black;/*移动滑块边框颜色*/
			scrollbar-track-color: #ccc;/*背景颜色*/
			scrollbar-arrow-color: #ddd;/*箭头颜色*/
		}
		.filter::-webkit-scrollbar-track
		{
			-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
			background-color: #ccc;
		}/* 滚动条的滑轨背景颜色 */
		.filter::-webkit-scrollbar
		{
			width: 6px;
			background-color: #ccc;
		}

		.filter::-webkit-scrollbar-thumb
		{
			background-color: gainsboro;
		}
	</style>
</head>

<body>

    <div class="wrapper">
		<div th:replace="~{admin/adminCommonbar::sidebar(activeUrl='editBook',level=2)}"></div>
        <div class="main-panel">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-minimize">
                        <button id="minimizeSidebar" class="btn btn-round btn-white btn-fill btn-just-icon">
							<i class="ti-arrow-left"></i>
                        </button>
                    </div>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#"> Form </a>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="ti-bell"></i>
                                    <span class="notification">6</span>
                                    <p class="hidden-lg hidden-md">
                                        Notifications
                                        <b class="caret"></b>
                                    </p>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="#">You have 5 new messages</a>
                                    </li>
                                    <li>
                                        <a href="#">You're now friend with Mike</a>
                                    </li>
                                    <li>
                                        <a href="#">Wish Mary on her birthday!</a>
                                    </li>                                    <li>
                                        <a href="#">5 warnings in Server Console</a>
                                    </li>
                                    <li>
                                        <a href="#">Jane completed 'Induction Training'</a>
                                    </li>
                                    <li>
                                        <a href="#">'Prepare Marketing Report' is overdue</a>
                                    </li>
                                </ul>
                            </li>
							<li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="ti-layout-grid3-alt"></i>
                                    <p class="hidden-lg hidden-md">Apps</p>
                                </a>
                            </li>
                            <li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="ti-user"></i>
                                    <p class="hidden-lg hidden-md">Profile</p>
                                </a>
                            </li>
							<li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="ti-settings"></i>
                                    <p class="hidden-lg hidden-md">Settings</p>
                                </a>
                            </li>
                            <li class="separator hidden-lg hidden-md"></li>
                        </ul>
                    </div>
                </div>
            </nav>


            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
		                        <form id="allInputsFormValidation" class="form-horizontal" action="" method="post" novalidate="">
		                            <div class="content">
		                                <h4 class="title">图书编辑</h4>

										<fieldset>
											<div class="form-group">
												<label class="col-sm-2 control-label">
													书名
												</label>
												<div class="col-sm-6">
													<input th:value="${bookDetail.title}" class="form-control"
														   type="text"
														   name="title"
													/>
												</div>

											</div>
										</fieldset>
		                                <fieldset>
		                                    <div class="form-group">
		                                        <label class="col-sm-2 control-label">
													作者
												</label>

												<div class="col-sm-4">
														<select   id="author" name="authorIdAndName" class="nice-select">
																<option value="">选择作者…</option>
																<option th:selected="${author.id==bookDetail.authors.get(0).id}?'true'" th:each="author:${authors}" th:value="${author.id}+'-'+${author.name}" th:text="${author.name}"></option>

														</select>
													</div>
												</div>
		                                </fieldset>



		                                <fieldset>
		                                    <div class="form-group">
		                                        <label class="col-sm-2 control-label">
													价格
												</label>
		                                        <div class="col-sm-2">
		                                            <input th:value="${bookDetail.price}" class="form-control"
		                                                   type="text"
		                                                   name="price"
													/>
		                                        </div>
		                                    </div>
		                                </fieldset>

		                                <fieldset>
		                                    <div class="form-group">
		                                        <label class="col-sm-2 control-label">
													出版社
												</label>
		                                        <div class="col-sm-6">
		                                            <input th:value="${bookDetail.publisher}" class="form-control"
		                                                   type="text"
		                                                   name="publisher"
													/>
		                                        </div>
		                                    </div>
		                                </fieldset>

										<fieldset>
											<div class="form-group">
												<label class="col-sm-2 control-label">
													ISBN
												</label>
												<div class="col-sm-3">
													<input th:value="${bookDetail.isbn}" class="form-control"
														   id="isbn"
														   type="text"
														  name="isbn"
													/>
												</div>
											</div>
										</fieldset>

		                                <!--<fieldset>-->
		                                    <!--<div id="tagGroup" class="form-group column-sizing">-->
		                                    	<!--<label class="col-sm-2 control-label">-->
													<!--标签-->
												<!--</label>-->
	                                    		<!--<div style="float: left;margin-left: 10px" level="1" class="tag">-->
													<!--<select  name="tagIdAndName" class="nice-select">-->
														<!--<option value="" selected>选择标签…</option>-->
														<!--<option th:each="tag:${tagHead.sonTags}" th:value="${tag.id}+'-'+${tag.name}" th:text="${tag.name}"></option>-->
													<!--</select>-->
	                                    		<!--</div>-->

												<!--<button type="button" id="addTagLink" style="margin-left: 5px" class="btn btn-primary">添加标签链</button>-->
		                                	<!--</div>-->
		                                <!--</fieldset>-->
										<fieldset>
											<div class="form-group">
												<label class="col-sm-2 control-label">
													库存
												</label>
												<div class="col-sm-2">
													<input th:value="${bookDetail.stock}" class="form-control"
														   type="text"
														   name="stock"

													/>
												</div>

												<label class="col-sm-2 control-label">
													出版时间
												</label>
												<div class="col-sm-3">
													<input th:value="${bookDetail.publishDate}" class="form-control"
														   type="date"
														   name="publishDate"

													/>
												</div>
											</div>
										</fieldset>
										<!--<fieldset >-->
											<!--<div class="form-group">-->
												<!--<label class="col-sm-2 control-label">图片</label>-->

												<!--<div style="float: left;margin-left: 10px">-->
													<!--<input name="bookImg" multiple="multiple" class="realImg" style="display: none" type="file">-->
													<!--<div style="border:1px solid black;height: 100px;width: 80px">-->
														<!--<img style="display: block;width: 100px;height: 100px" class="uploadImg" >-->
													<!--</div>-->
													<!--<button type="button" class="uploadImg btn btn-primary btn-round">上传</button>-->
												<!--</div>-->

												<!--<button type="button" id="addBookImg" style="margin-left: 5px" class="btn btn-primary">添加图片</button>-->


											<!--</div>-->

										<!--</fieldset>-->
										<fieldset >
											<div class="form-group">
												<label class="col-sm-2 control-label">目录</label>
												<div class="col-sm-8">
													<textarea th:text="${bookDetail.catalog}" th:value="${bookDetail.catalog}" name="catalog" class="form-control" placeholder="图书目录" rows="10"></textarea>
												</div>
											</div>
										</fieldset>
										<fieldset>
											<div class="form-group">
												<label class="col-sm-2 control-label">简介</label>
												<div class="col-sm-8">
													<textarea th:text="${bookDetail.summary}" th:value="${bookDetail.summary}" name="summary" class="form-control" placeholder="图书简介" rows="10"></textarea>
												</div>
											</div>
										</fieldset>
		                            </div>
									<div class="card-footer text-center">
										<button id="submitForm" type="button" class="btn btn-info btn-fill">提交</button>
									</div>
		  						</form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">
                        <ul>
                            <li>
                                <a href="#">
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Documentation
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Contact
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Support
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <p class="copyright pull-right">
                        &copy;
                        <script>
                            document.write(new Date().getFullYear())
                        </script>
                        <a href="http://www.bootstrapmb.com/">Amaze Admin</a>
                    </p>
                </div>
            </footer>
        </div>
    </div>
<!--   Core JS Files   -->
<script src="/adminAssets/vendors/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="/adminAssets/vendors/jquery-ui.min.js" type="text/javascript"></script>
<script src="/adminAssets/vendors/bootstrap.min.js" type="text/javascript"></script>
<script src="/adminAssets/vendors/material.min.js" type="text/javascript"></script>
<script src="/adminAssets/vendors/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<!-- Forms Validations Plugin -->
<script src="/adminAssets/vendors/jquery.validate.min.js"></script>
<!--  Plugin for Date Time Picker and Full Calendar Plugin-->
<script src="/adminAssets/vendors/moment.min.js"></script>
<!--  Charts Plugin -->
<script src="/adminAssets/vendors/chartist.min.js"></script>
<!--  Plugin for the Wizard -->
<script src="/adminAssets/vendors/jquery.bootstrap-wizard.js"></script>
<!--  Notifications Plugin    -->
<script src="/adminAssets/vendors/bootstrap-notify.js"></script>
<!-- DateTimePicker Plugin -->
<script src="/adminAssets/vendors/bootstrap-datetimepicker.js"></script>
<!--  Checkbox, Radio, Switch and Tags Input Plugins -->
<script src="/adminAssets/js/bootstrap-checkbox-radio-switch-tags.js"></script>
<!-- Vector Map plugin -->
<script src="/adminAssets/vendors/jquery-jvectormap.js"></script>
<!-- Sliders Plugin -->
<script src="/adminAssets/vendors/nouislider.min.js"></script>
<!-- Select Plugin -->
<script src="/adminAssets/vendors/jquery.select-bootstrap.js"></script>
<!--  DataTables.net Plugin    -->
<script src="/adminAssets/vendors/jquery.datatables.js"></script>
<!-- Sweet Alert 2 plugin -->
<script src="/adminAssets/vendors/sweetalert/js/sweetalert2.min.js"></script>
<!--	Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
<script src="/adminAssets/vendors/jasny-bootstrap.min.js"></script>
<!--  Full Calendar Plugin    -->
<script src="/adminAssets/vendors/fullcalendar.min.js"></script>
<!-- TagsInput Plugin -->
<script src="/adminAssets/vendors/jquery.tagsinput.js"></script>
<!-- Material Dashboard javascript methods -->
<script src="/adminAssets/js/amaze.js"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="/adminAssets/js/demo.js"></script>
	<script src="/assets/js/vendor/jquery.min.js"></script>

	<!-- Bootstrap and Popper Bundle JS -->
	<script src="/assets/js/bootstrap.bundle.min.js"></script>

	<!-- All Plugins Js -->
	<script src="/assets/js/plugins.js"></script>

	<!-- Ajax Mail Js -->
	<script src="/assets/js/ajax-mail.js"></script>

	<!-- Main JS -->
	<script src="/assets/js/main.js"></script>

	<!-- REVOLUTION JS FILES -->
	<script src="/assets/js/revoulation/jquery.themepunch.tools.min.js"></script>
	<script src="/assets/js/revoulation/jquery.themepunch.revolution.min.js"></script>

	<!-- SLIDER REVOLUTION 5.0 EXTENSIONS  (Load Extensions only on Local File Systems !  The following part can be removed on Server for On Demand Loading) -->
	<script src="/assets/js/revoulation/extensions/revolution.extension.actions.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.carousel.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.kenburn.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.layeranimation.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.migration.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.navigation.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.parallax.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.slideanims.min.js"></script>
	<script src="/assets/js/revoulation/extensions/revolution.extension.video.min.js"></script>

	<!-- REVOLUTION ACTIVE JS FILES -->
	<script src="/assets/js/revoulation.js"></script>

	<!-- Ajax Mail Js -->

	<!-- Main JS -->
	<!--<script src="/assets/js/main.js"></script>-->



	<!-- REVOLUTION ACTIVE JS FILES -->

<script th:inline="javascript">
	window.onload=function (ev) {
	var tagMap = [[${tagMap}]];
	var head = [[${tagHead}]];
	var bookImgNum = 1;
	var tagLinkNum = 1;

        function getObjectURL(file) {
            var url = null;
            if (window.createObjcectURL != undefined) {
                url = window.createOjcectURL(file);
            } else if (window.URL != undefined) {
                url = window.URL.createObjectURL(file);
            } else if (window.webkitURL != undefined) {
                url = window.webkitURL.createObjectURL(file);
            }
            return url;
        }

        $(document).on('click', '#submitForm', function (){
            var inputs = $("input")
			// for (var i = 0;i<inputs.length;i++){
             //    if (inputs.eq(i).val()==""||inputs.eq(i).val()==null){
             //        alert("请填写所有信息")
			// 		return
			// 	}
			// }


            var data = new FormData($("#allInputsFormValidation")[0]);
            $.ajax({
                url: "/bookService/book",
                type: 'put', //
                async: true,    //或false,是否异步
                data: data,
                // contentType:"application/json;charset=utf-8",
                processData : false,  //必须false才会避开jQuery对 formdata 的默认处理
                contentType : false,
                cache: false,

                timeout: 50000,    //超时时间
                dataType: 'text',    //返回的数据格式：json/xml/html/script/jsonp/text
                success: function (data) {

                },
                error: function (data) {

                }
            })

        })
        $(document).on('click', '#addTagLink', function (){
            if (tagLinkNum==4){
                alert("够了够了");
                return;
			}
			tagLinkNum++;
            var sonTags = head.sonTags;
            var optionHTML = "";
            var liHTML = "";
            for (var i = 0;i<sonTags.length;i++){
                optionHTML+="<option  value="+sonTags[i].id+">"+sonTags[i].name+"</option>"
                liHTML+="<li data-value="+sonTags[i].id+"-"+ sonTags[i].name+" class=\"option focus\">"+sonTags[i].name+"</li>"
            }
            $(this).parent().after("<div class=\"form-group\">\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"col-sm-2 control-label\">\n" +

                "\t\t\t\t\t\t\t\t\t\t\t\t</label>\n" +
                "<div style=\"float: left;margin-left: 10px\"" +
                " level=1 class=\"tag\">\n" +
                "               <select name=\"tagIdAndName\" class=\"nice-select\" style=\"display: none;\">\n" +
                "               <option value=\"\" selected=\"\">选择标签…</option>\n" +
                optionHTML+
                "               </select>" +
                "<div class=\"nice-select\" tabindex=\"0\">" +
                "<span class=\"current\">选择标签</span><div class=\"nice-select-search-box\">" +
                "<input type=\"text\" class=\"nice-select-search\" placeholder=\"Search...\"></div>" +
                "<ul class=\"list\">" +
                "<li data-value=\"\" class=\"option\">选择标签…</li>" +
                liHTML+
                "</ul></div>\n" +
                "           </div><button type='button' style='margin-left: 10px' class='deleteTagLink btn btn-danger'>刪除此标签链</button>"+
                "\n" +
                "\t\t\t\t\t\t\t\t\t\t\t</div> ")

        })

        $(document).on('click', '.deleteTagLink', function (){
            tagLinkNum--;
            $(this).parent().remove()

        })
        $(document).on('click', '.uploadImg', function (){
            $(this).parent().find("input").eq(0).click()
        })
        $(document).on('change', '.realImg', function (e){

            var file= $(this)[0].files[0];

            var filePath = getObjectURL(file),         //获取到input的value，里面是文件的路径
                fileFormat = $(this).val().substring(filePath.lastIndexOf(".")).toLowerCase();
            // 检查是否是图片
            if( !fileFormat.match(/.png|.jpg|.jpeg/) ) {
               alert('上传错误,文件格式必须为：png/jpg/jpeg');
               // $(this).val("");
                return;
            }
            $(this).parent().find("img").eq(0).attr("src",filePath)


        })

        $(document).on('click', '#addBookImg', function (){
            if (bookImgNum==5){
                alert("够了够了");
                return false;
			}
            bookImgNum++;
            $(this).before("<div style=\"float: left;margin-left: 10px\">\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t\t<input name=\"bookImg\" multiple=\"multiple\" class=\"realImg\" style=\"display: none\" type=\"file\">\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"border:1px solid black;height: 100px;width: 80px\">\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img style=\"display: block;width: 100px;height: 100px\" class=\"uploadImg\" >\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"uploadImg btn btn-primary btn-xs\">上传</button><button type=\"button\" class=\"deleteImg btn btn-danger btn-xs\">删除</button>\n" +
                "\t\t\t\t\t\t\t\t\t\t\t\t</div>")
        })

        $(document).on('click', '.deleteImg', function (){
            bookImgNum--;
            $(this).parent().remove()
        })
    $(document).on('click', '.tag .option', function (){
        var level = $(this).parent().parent().parent().attr("level");
        var tags = $(this).parent().parent().parent().parent().find(".tag");
        for (var i = 0;i<tags.length;i++){
            if (tags.eq(i).attr("level")>level)
                tags.eq(i).remove()
        }
        var tagId = $(this).attr("data-value").substring(0,$(this).attr("data-value").indexOf("-"));
        if (tagId==null||tagId=="")
            return

       var tag = tagMap[tagId];
       var sonTags= tag.sonTags;

       if (sonTags.length>0){

		   var optionHTML = "";
		   var liHTML = "";
           for (var i = 0;i<sonTags.length;i++){
               optionHTML+="<option  value="+sonTags[i].id+"-"+sonTags[i].name+" >"+sonTags[i].name+"</option>"
				liHTML+="<li data-value="+sonTags[i].id+"-"+sonTags[i].name+" class=\"option focus\">"+sonTags[i].name+"</li>"
		   }
		   level++;
           $(this).parent().parent().parent().after("<div style=\"float: left;margin-left: 5px\"" +
			   " level="+level+" class=\"tag\">\n" +
               "               <select name=\"tagIdAndName\" class=\"nice-select\" style=\"display: none;\">\n" +
               "               <option value=\"\" selected=\"\">选择标签…</option>\n" +
									optionHTML+
               "               </select>" +
			   "<div class=\"nice-select\" tabindex=\"0\">" +
			   "<span class=\"current\">选择标签</span><div class=\"nice-select-search-box\">" +
			   "<input type=\"text\" class=\"nice-select-search\" placeholder=\"Search...\"></div>" +
			   "<ul class=\"list\">" +
			   "<li data-value=\"\" class=\"option\">选择标签…</li>" +
				   liHTML+
			  			   "</ul></div>\n" +
               "           </div>")
	   }


    })


}


</script>
</body>
</html>
